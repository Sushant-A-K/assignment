create database evalSush;
use evalSush;

CREATE TABLE SALES(
	SALE_ID INT PRIMARY KEY,
    SALESPERSON_ID INT NOT NULL,
    REGION VARCHAR(30),
    SALE_AMOUNT INT,
    SALE_DATE DATE
    );

INSERT INTO SALES VALUES (1,401,'BENGALURU',45000,'2023-04-13'),
(2,701,'MUMBAI',30000,'2023-05-13'),
(3,501,'DELHI',26000,'2023-06-13'),
(4,601,'KOLKATA',10000,'2023-07-13'),
(5,702,'MUMBAI',1500,'2023-05-14'),
(6,502,'DELHI',2600,'2023-06-18'),
(7,602,'KOLKATA',21640,'2023-07-19'),
(8,402,'BENGALURU',6800,'2023-02-13'),
(9,703,'MUMBAI',8920,'2023-01-14'),
(10,503,'DELHI',11250,'2023-01-18'),
(11,603,'KOLKATA',21640,'2023-01-19'),
(12,403,'BENGALURU',9850,'2023-01-13');

SELECT * FROM SALES;
WITH SALES_RANKED AS(
SELECT REGION, SALESPERSON_ID,SUM(SALE_AMOUNT) AS TOTAL_SALES_in_2023,
DENSE_RANK() OVER (
	PARTITION BY REGION
    ORDER BY SUM(SALE_AMOUNT) DESC) AS SALES_RANK
FROM SALES
WHERE YEAR(SALE_DATE)=2023
GROUP BY REGION,SALESPERSON_ID)
SELECT * FROM SALES_RANKED WHERE SALES_RANK<=3;
    
